# 🛡️ Microsoft Defender & Sentinel Phishing Simulation Lab Documentation
**Date:** July 10, 2025
---
## 🔧 Lab Overview
- **Project:** Simulate phishing attack, detect in Microsoft Defender, correlate in Sentinel, and respond automatically.
- **Environment:**
  - Azure VM (`Windowlogdemo`)
  - Windows Server 2019 (Standard B2s)
  - Parrot OS (VM on spare laptop)
  - Microsoft 365 Business Premium tenant (`kasoa.gees`)
---
## ✅ Completed Steps
### 1. Azure VM Setup
- Created VM: `Windowlogdemo`
- Resized to: `Standard B2s` for better performance
- Verified public IP and RDP working

### 2. Defender for Endpoint Onboarding
- Downloaded onboarding script from Microsoft 365 Defender portal
- RDP’d into VM
- Ran script via Admin Command Prompt from Desktop
- Successfully onboarded VM (verified in [security.microsoft.com/devices](https://security.microsoft.com/devices))

### 3. Attack Machine Configuration (Parrot OS)
- Set up virtual environment: `phishing_env`
- Installed MailSlurp Python SDK with `pip install mailslurp-client`
- Created phishing script using authenticated MailSlurp API
- Debugged common issues:
  - Non-breaking space (U+00A0)
  - Indentation errors
  - Email format syntax issues

### 4. Attempted Phishing Email Delivery
- Tried `sendmail` — failed due to missing binary and local relay issues
- Switched to MailSlurp + Python for reliable SMTP
- Built a working email payload: subject, body, malicious-looking link

---
## 🐞 Key Errors Encountered and Fixed
- ❌ `sendmail: command not found` → installed `mailutils` and `sendmail`
- ❌ `SyntaxError: invalid non-printable character U+00A0` → retyped lines
- ❌ `IndentationError` → fixed missing indents in Python block
- ❌ `SyntaxError: invalid character in identifier` → corrected `to=["email"]` format
- ❌ Nano opened inside Python shell → exited interpreter using `exit()`

---
## 📸 Screenshots Captured and Tagged
- ✅ Azure portal VM details (`IMG_55FB70E6...`)
- ✅ Defender onboarding success (`IMG_984C00B5...`)
- ✅ MailSlurp Python errors (`IMG_0469`, `IMG_CADD2577...`)
- ✅ Final U+00A0 and indent fixes (`IMG_0469`, `IMG_58011695...`)
- ✅ Virtual environment activation and package install steps

---
## ⏸️ Status at Pause
- Script almost ready to send phishing email via MailSlurp
- Last known issue: syntax/indent error + need clean `to=[]` email input
- Next: Deliver email → click link → detect in Sentinel

---
## ✍️ To Resume
- Reopen `phishing_email.py`
- Fix any syntax issues
- Run in Parrot OS virtual environment
- Confirm email delivery in Outlook Web
- Click link from Defender-onboarded VM
- Proceed with Sentinel detection rule
---
Generated by ChatGPT as real-time documentation based on your screenshots and actions.